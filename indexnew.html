<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Multi Marker AR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>
<a-scene
  embedded
  arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  vr-mode-ui="enabled: false"
  renderer="logarithmicDepthBuffer: true;"
>

  <a-assets>
    <!-- Replace with your real models -->
    <a-asset-item id="m1" src="assets/model1.glb"></a-asset-item>
    <a-asset-item id="m2" src="assets/model2.glb"></a-asset-item>
    <a-asset-item id="m3" src="assets/model3.glb"></a-asset-item>
    <a-asset-item id="m4" src="assets/model4.glb"></a-asset-item>
    <a-asset-item id="m5" src="assets/model5.glb"></a-asset-item>
    <a-asset-item id="m6" src="assets/model6.glb"></a-asset-item>
    <a-asset-item id="m7" src="assets/model7.glb"></a-asset-item>
    <a-asset-item id="m8" src="assets/model8.glb"></a-asset-item>
    <a-asset-item id="m9" src="assets/model9.glb"></a-asset-item>
    <a-asset-item id="m10" src="assets/model10.glb"></a-asset-item>
  </a-assets>

  <!-- MARKERS -->
  <a-marker type="pattern" url="markers/1.patt">
    <a-gltf-model src="#m1" scale="0.3 0.3 0.3"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/2.patt">
    <a-gltf-model src="#m2" scale="0.15 0.15 0.15"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/3.patt">
    <a-gltf-model src="#m3" scale="0.6 0.6 0.6"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/4.patt">
    <a-gltf-model src="#m4" scale="0.25 0.25 0.25"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/5.patt">
    <a-gltf-model src="#m5" scale="0.4 0.4 0.4"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/6.patt">
    <a-gltf-model src="#m6" scale="0.2 0.2 0.2"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/7.patt">
    <a-gltf-model src="#m7" scale="0.5 0.5 0.5"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/8.patt">
    <a-gltf-model src="#m8" scale="0.18 0.18 0.18"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/9.patt">
    <a-gltf-model src="#m9" scale="0.35 0.35 0.35"></a-gltf-model>
  </a-marker>

  <a-marker type="pattern" url="markers/10.patt">
    <a-gltf-model src="#m10" scale="0.45 0.45 0.45"></a-gltf-model>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<!-- ZOOM + ROTATION -->
<script>
let activeModel = null;

// Detect visible model
function updateActiveModel() {
  document.querySelectorAll("a-gltf-model").forEach(m => {
    if (m.object3D.visible) activeModel = m;
  });
}

// ===== PINCH ZOOM =====
let startDistance = 0;
let startScale = 1;

document.addEventListener("touchstart", e => {
  updateActiveModel();
  if (!activeModel) return;

  if (e.touches.length === 2) {
    const dx = e.touches[0].pageX - e.touches[1].pageX;
    const dy = e.touches[0].pageY - e.touches[1].pageY;
    startDistance = Math.hypot(dx, dy);
    startScale = activeModel.object3D.scale.x;
  }
}, { passive: true });

document.addEventListener("touchmove", e => {
  if (!activeModel || e.touches.length !== 2) return;

  const dx = e.touches[0].pageX - e.touches[1].pageX;
  const dy = e.touches[0].pageY - e.touches[1].pageY;
  const distance = Math.hypot(dx, dy);

  let scale = startScale * (distance / startDistance);
  scale = Math.min(Math.max(scale, 0.05), 5);

  activeModel.object3D.scale.set(scale, scale, scale);
});

// ===== ROTATION =====
let dragging = false;
let lastX = 0;
let lastY = 0;
const ROT_SPEED = 0.005;

document.addEventListener("touchstart", e => {
  if (e.touches.length === 1) {
    updateActiveModel();
    if (!activeModel) return;
    dragging = true;
    lastX = e.touches[0].pageX;
    lastY = e.touches[0].pageY;
  }
}, { passive: true });

document.addEventListener("touchmove", e => {
  if (!dragging || !activeModel || e.touches.length !== 1) return;

  const dx = e.touches[0].pageX - lastX;
  const dy = e.touches[0].pageY - lastY;

  activeModel.object3D.rotation.y += dx * ROT_SPEED;
  activeModel.object3D.rotation.x += dy * ROT_SPEED;

  lastX = e.touches[0].pageX;
  lastY = e.touches[0].pageY;
});

document.addEventListener("touchend", () => dragging = false);
</script>

</body>
</html>
